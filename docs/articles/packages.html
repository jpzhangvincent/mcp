<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>An overview of change point packages in R • mcp</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="An overview of change point packages in R">
<meta property="og:description" content="">
<meta property="og:image" content="https://lindeloev.github.io/mcp/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-1026978-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-1026978-3');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mcp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    General usage
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/formulas.html">Formulas</a>
    </li>
    <li>
      <a href="../articles/priors.html">Priors</a>
    </li>
    <li>
      <a href="../articles/comparison.html">Hypotheses and model comparison</a>
    </li>
    <li>
      <a href="../articles/varying.html">Random/varying effects</a>
    </li>
    <li>
      <a href="../articles/variance.html">Modeling variance</a>
    </li>
    <li>
      <a href="../articles/arma.html">Time series and autocorrelation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    GLM
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/poisson.html">Poisson</a>
    </li>
    <li>
      <a href="../articles/binomial.html">Binomial and Bernoulli</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/packages.html">Comparison to other packages</a>
    </li>
    <li>
      <a href="../articles/debug.html">Tips, tricks, and debugging</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://twitter.com/jonaslindeloev">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/lindeloev/mcp">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>An overview of change point packages in R</h1>
                        <h4 class="author">Jonas Kristoffer Lindeløv</h4>
            
            <h4 class="date">2020-01-10</h4>
      
      
      <div class="hidden name"><code>packages.Rmd</code></div>

    </div>

    
    
<p>There are a lot of change point packages out there already, so why <code>mcp</code>? Here are my (probably biased) thoughts about this. I compiled some tables, summarising change point packages (<a href="https://github.com/lindeloev/mcp/raw/master/man/figures/packages_tables.xlsx">.xlsx file here</a>). I will demonstrate each of these packages in an applied example below to discuss their merits and shortcomings.</p>
<p>I think <code>segmented</code>, and <code>EnvCpt</code> are good if the data fits what they can model, and <code>mcp</code> is a more capable and general-purpose package at the cost of speed. You can see the immediate roadmap for <code>mcp</code> at the <a href="https://github.com/lindeloev/mcp/issues">GitHub issues tracker</a>.</p>
<div id="modeling-options" class="section level2">
<h2 class="hasAnchor">
<a href="#modeling-options" class="anchor"></a>Modeling options</h2>
<p>How much flexibility does the package allow for modeling the system, you’re studying? A clear difference here is between packages that allow you to <em>specify</em> the number of change points, and packages which infer the number of change points <em>automatically</em> (using some criteria), captured in the <code>N</code> column below.</p>
<p><img src="https://github.com/lindeloev/mcp/raw/master/man/figures/packages_table1.png"></p>
<p><br><br></p>
</div>
<div id="inference" class="section level2">
<h2 class="hasAnchor">
<a href="#inference" class="anchor"></a>Inference</h2>
<p>What can you learn, once the model has fitted? While all packages return the estimated Change Points, few return an index of uncertainty around that estimate (<code>CP CI</code>: confidence intervals, highest-density intervals, or posterior densities). Sometimes, it may not even be the change point that is of interest, but rather the parameters of the segments in between (<code>params</code>, <code>params CI</code>). Finally, you may want to compare models, e.g., testing whether a change point is present or not, or testing the nature of the segments between change points (<code>hypothesis tests</code>).</p>
<p>Note that <code>EnvCpt</code> returns one log-likelihood per model, which one then could do testing on. <code>segmented</code> returns AIC and deviance, so ditto here. However, this is something you would have to do yourself. <code>mcp</code> explicitly supports and recommends workflows for detailed model comparisons.</p>
<p><img src="https://github.com/lindeloev/mcp/raw/master/man/figures/packages_table2.png"></p>
<p><br><br></p>
</div>
<div id="other-conveniences" class="section level2">
<h2 class="hasAnchor">
<a href="#other-conveniences" class="anchor"></a>Other conveniences</h2>
<p>This is a list of other functions, which I find useful on other statistics packages, including simulating data, getting fitted and predicted values given the model, and an assessment of speed. The option to include prior knowledge could be important in some situations.</p>
<p><img src="https://github.com/lindeloev/mcp/raw/master/man/figures/packages_table3.png"></p>
</div>
<div id="unique-features-of-mcp" class="section level1">
<h1 class="hasAnchor">
<a href="#unique-features-of-mcp" class="anchor"></a>Unique features of mcp</h1>
<ul>
<li>Manually specify the segment structure. Other packages allow for specifying segment structure, but it has to be shared for all segments. Read more about <a href="../articles/formulas.html">the formula syntax</a> in <code>mcp</code>.</li>
<li>Posterior distribution for each change point. This matters since they rarely conform to known distributions so confidence intervals can be misleading.</li>
<li>
<em>varying change points</em>: To my knowledge, no other package implements varying change points, i.e., allowing by-group differences in change points while sharing all other parameters. Read more about <a href="../articles/varying.html">varying change points</a> in <code>mcp</code>.</li>
<li>
<em>Sharing and fixing parameters</em> to values and other parameters as discussed under <a href="../articles/priors.html">priors in mcp</a>.</li>
<li>
<em>Per-segment regression on variance and autocorrelation</em> via the <code><a href="https://rdrr.io/r/stats/sigma.html">sigma()</a></code> (<a href="../articles/variance.html">read more here</a>) and <code><a href="https://rdrr.io/r/stats/ar.html">ar()</a></code> (<a href="../articles/arma.html">read more here</a>) terms, also allowing for more advanced change points involving, e.g., a change in autocorrelation strength.</li>
<li>
<em>Explicit priors</em>: <code>bcp</code> is the only other Bayesian change point package I know of. It contains a few high-level prior parameters, but not for specific parameters such as <em>where</em> change points are expected to occur etc. Read more about <a href="../articles/priors.html">priors in mcp</a> for more.</li>
<li>
<em>Prior and posterior predictive checks</em>. In general, most other packages have limited or no model checking functionality. The default <code>plot.mcpfit</code> is inherently a visual predictive check and can be applied to priors (<code><a href="../reference/mcp.html">mcp(..., sample = "prior")</a></code> and posteriors. Of course inspecting Gelman-Rubin statistics and effective sample sizes in <code>summary.mcpfit</code>, as well as trace plots (<code><a href="../reference/plot_pars.html">plot_pars(fit, type = "trace")</a></code>), also go a long way.</li>
<li>Flexible hypothesis testing using <code>loo</code> and <code>hypothesis</code>, including testing the existence of a change point. Most other packages stop at estimation, though some provide p-values. Read more about <a href="../articles/comparison.html">hypothesis testing and model comparison</a> using <code>mcp</code>.</li>
</ul>
</div>
<div id="recommendation" class="section level1">
<h1 class="hasAnchor">
<a href="#recommendation" class="anchor"></a>Recommendation</h1>
<p>Let me go all-out on my ego-serving bias and say that <code>mcp</code> is the best package <em>unless:</em></p>
<ul>
<li>
<em>You have a lot of data and limited time</em>: While <code>mcp</code> is reasonably fast for typical problems, MCMC sampling is slower than analytical and specialized solutions. For datasets &gt; 20.000 points and a complicated model, it may take <code>mcp</code> hours (but not days) to fit. See <a href="../articles/tips.html">tips and tricks</a> how to speed up <code>mcp</code>. Briefly, run in parallel and lower the number of iterations: (<code>mcp(..., cores = 4, iter = 1000, adapt = 400</code>).</li>
<li>
<em>You want to automatically detect a large number of change points</em>: Most packages does automatic change point detection. This is not a space that <code>mcp</code> tries to fill. But beware that many of the automatic procedures did not capture a change point in the worked examples below. If recommend <code>segmented</code> for the models it “understands” followed by <code>EnvCpt</code> and perhaps <code>bcp</code>.</li>
<li>
<em>Multivariate</em>: <code>mcp</code> only does univariate regression, both for <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span>. This will be implemented if there is a popular request for it. Don’t hesitate to raise an issue on GitHub. For now, <code>bcp</code> seems like the best option to me.</li>
</ul>
</div>
<div id="a-simple-dataset-to-compare-packages" class="section level1">
<h1 class="hasAnchor">
<a href="#a-simple-dataset-to-compare-packages" class="anchor"></a>A simple dataset to compare packages</h1>
<p>As a simple example, we simulate some intercept-only data with change points at 30 (from mean=2 to mean=0) and 70 (to mean=1) and a residual of 1 SD.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># Simulate</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">42</span>)  <span class="co"># I always use 42; no fiddling</span></a>
<a class="sourceLine" id="cb1-3" title="3">df =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(</a>
<a class="sourceLine" id="cb1-4" title="4">  <span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb1-5" title="5">  <span class="dt">y =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="dv">30</span>, <span class="dv">2</span>), <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="dv">40</span>, <span class="dv">0</span>), <span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="dv">30</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb1-6" title="6">)</a>
<a class="sourceLine" id="cb1-7" title="7"></a>
<a class="sourceLine" id="cb1-8" title="8"><span class="co"># Plot it</span></a>
<a class="sourceLine" id="cb1-9" title="9"><span class="kw"><a href="../reference/plot.mcpfit.html">plot</a></span>(df)</a>
<a class="sourceLine" id="cb1-10" title="10"><span class="kw"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="dt">v =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">30</span>, <span class="dv">70</span>), <span class="dt">col=</span><span class="st">"red"</span>)</a></code></pre></div>
<p><img src="packages_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
</div>
<div id="mcp" class="section level1">
<h1 class="hasAnchor">
<a href="#mcp" class="anchor"></a>mcp</h1>
<p><code>mcp</code> needs no further introduction. We fit the three-plateaus model with default priors:.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mcp)</a>
<a class="sourceLine" id="cb2-2" title="2">model =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(y<span class="op">~</span><span class="dv">1</span>, <span class="dv">1</span><span class="op">~</span><span class="dv">1</span>, <span class="dv">1</span><span class="op">~</span><span class="dv">1</span>)  <span class="co"># three intercept-only segments</span></a>
<a class="sourceLine" id="cb2-3" title="3">fit_mcp =<span class="st"> </span><span class="kw"><a href="../reference/mcp.html">mcp</a></span>(model, <span class="dt">data =</span> df, <span class="dt">par_x =</span> <span class="st">"x"</span>)</a>
<a class="sourceLine" id="cb2-4" title="4"></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw"><a href="../reference/summary.mcpfit.html">summary</a></span>(fit_mcp)</a></code></pre></div>
<pre><code>## Family: gaussian(link = 'identity')
## Iterations: 9000 from 3 chains.
## Segments:
##   1: y ~ 1
##   2: y ~ 1 ~ 1
##   3: y ~ 1 ~ 1
## 
## Population-level parameters:
##     name  mean lower upper Rhat n.eff
##     cp_1 30.73 27.16 33.99    1  1819
##     cp_2 63.66 46.87 76.65    1   982
##    int_1  2.04  1.63  2.43    1  4352
##    int_2 -0.08 -0.52  0.38    1  1990
##    int_3  0.92  0.51  1.30    1  1784
##  sigma_1  1.06  0.91  1.22    1  4755</code></pre>
<p>The summary shows good parameter recovery, though the second change point is detected a bit early. This is understandable if you look at the data, and the true change point is still within the highest density interval.</p>
<p>Plotting the posterior distributions of the change points reveal that they are not well represented by a Gaussian or other known distributions. Therefore, confidence intervals are likely to be meaningless for this problem.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(patchwork)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="kw"><a href="../reference/plot.mcpfit.html">plot</a></span>(fit_mcp) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="../reference/plot_pars.html">plot_pars</a></span>(fit_mcp, <span class="dt">pars =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"cp_1"</span>, <span class="st">"cp_2"</span>), <span class="dt">type =</span> <span class="st">"dens_overlay"</span>)</a></code></pre></div>
<p><img src="packages_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p><code>mcp</code> takes around 6 seconds to fit this example, which is the slowest of all the packages considered here. You can bring that down to 2.5 seconds by running in parallel, using <code><a href="../reference/mcp.html">mcp(..., cores = 3)</a></code> or for the full session using <code><a href="https://rdrr.io/r/base/options.html">options(mc.cores = 3)</a></code>.</p>
</div>
<div id="envcpt" class="section level1">
<h1 class="hasAnchor">
<a href="#envcpt" class="anchor"></a>EnvCpt</h1>
<p><code>EnvCpt</code> can detect change points in mean and variance (not separately), slopes (“trends”), and AR(1)/AR(2), as well as conveniently fitting various models without change points. It automatically infers the number of change points. Unless otherwise instructed (through <code>models</code> argument), <code>EnvCpt</code> fits all models to the data, allowing you to pick one. It allows</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(EnvCpt)</a>
<a class="sourceLine" id="cb5-2" title="2">fit_envcpt =<span class="st"> </span><span class="kw">envcpt</span>(df<span class="op">$</span>y)  <span class="co"># Fit all models at once</span></a>
<a class="sourceLine" id="cb5-3" title="3">fit_envcpt<span class="op">$</span>summary  <span class="co"># Show log-likelihoods</span></a></code></pre></div>
<p>This can be used to maximize the log-likelihood. Of interest here is <code>meancpt</code>. The documentation says that it calls <code><a href="https://rdrr.io/pkg/changepoint/man/cpt.meanvar.html">changepoint::cpt.meanvar</a></code>, modeling a simultaneous change in mean and variance. Curiously, <code><a href="https://rdrr.io/pkg/changepoint/man/cpt.meanvar.html">changepoint::cpt.meanvar(df$y)</a></code> only finds one change point when called directly (see below), but the output matches <code>changepoint.np::cpt.np(df$y)@cpts</code>, so I suspect that this function is used instead. <code>EnvCpt</code> has a nice plot of all the models:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw"><a href="../reference/plot.mcpfit.html">plot</a></span>(fit_envcpt)</a></code></pre></div>
<p><img src="packages_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
<p>Digging into the <code>meancpt</code>, we get maximum-likelihood estimates of the change points and the parameters of each segment.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">fit_envcpt<span class="op">$</span>meancpt<span class="op">@</span>cpts</a></code></pre></div>
<pre><code>## [1]  30  65 100</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">fit_envcpt<span class="op">$</span>meancpt<span class="op">@</span>param.est</a></code></pre></div>
<pre><code>## $mean
## [1]  2.06858683 -0.07385687  0.96511049
## 
## $variance
## [1] 1.5225923 1.0064793 0.6442151</code></pre>
<p>I think the change point at <code>x = 100</code> should just be ignored. We see that it approximately identifies the change points, though without intervals.</p>
</div>
<div id="segmented" class="section level1">
<h1 class="hasAnchor">
<a href="#segmented" class="anchor"></a>segmented</h1>
<p><code>segmented</code> seems to be the most popular package for change point analysis. It has a very shallow learning curve combined with great modeling flexibility. You simply specify your model in <code>lm</code>, <code>glm</code>, <code>Arima</code>, and also work for e.g. <code>coxph</code> (Cox proportional Hazard). Supply it to <code>segmented</code> which then segment your data along the x-axis and applies the linear model in each segment. The trick is identifying the locations where this split works the best. The positive consequence is that you get great modeling flexibility with GLM, AR(1) models, etc.</p>
<p>The downside is that you can only have one <em>kind</em> of segments and (for some reason) <em>it ignores the intercepts on anything but the first segment</em>. Only (joined) slopes are supported in segment 2+. Unfortunately, this means that <code>segmented</code> fails for the present changing-intercept data. In my limited testing, it also ignores quadratic and other terms, so even though the design philosophy is excellent, you have to carefully double-check whether it actually models what you asked it to.</p>
<p><code>segmented</code> is otherwise well developed with prediction functions, (frequentist) intervals, plots, etc. so if you have large datasets with impermissible long run times in <code>mcp</code> and it matches what <code>segmented</code> can model, it is a good option.</p>
<p>Enough talk:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(segmented)</a>
<a class="sourceLine" id="cb11-2" title="2">fit_lm =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span>(y <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>x, <span class="dt">data =</span> df)  <span class="co"># intercept-only model</span></a>
<a class="sourceLine" id="cb11-3" title="3">fit_segmented =<span class="st"> </span><span class="kw">segmented</span>(fit_lm, <span class="dt">seg.Z =</span> <span class="op">~</span>x, <span class="dt">npsi =</span> <span class="dv">2</span>)  <span class="co"># Two change points along x</span></a>
<a class="sourceLine" id="cb11-4" title="4"></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="kw"><a href="../reference/summary.mcpfit.html">summary</a></span>(fit_segmented)</a></code></pre></div>
<pre><code>## 
##  ***Regression Model with Segmented Relationship(s)***
## 
## Call: 
## segmented.lm(obj = fit_lm, seg.Z = ~x, npsi = 2)
## 
## Estimated Break-Point(s):
##           Est. St.Err
## psi1.x 40.217  3.659
## psi2.x 91.000  4.989
## 
## Meaningful coefficients of the linear terms:
##             Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  3.28673    0.33873   9.703 7.86e-16 ***
## x           -0.08916    0.01440  -6.192 1.55e-08 ***
## U1.x         0.12164    0.01770   6.871       NA    
## U2.x        -0.13783    0.11618  -1.186       NA    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.051 on 94 degrees of freedom
## Multiple R-Squared: 0.4154,  Adjusted R-squared: 0.3843 
## 
## Convergence attained in 1 iter. (rel. change 9.9261e-06)</code></pre>
<p>As expected, the change points are off (<code>psi1.x</code> and <code>psi2.x</code>). The default plot is sparse, but you can quickly add more info:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw"><a href="../reference/plot.mcpfit.html">plot</a></span>(fit_segmented)</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="kw"><a href="https://rdrr.io/r/graphics/points.html">points</a></span>(df)</a>
<a class="sourceLine" id="cb13-3" title="3"><span class="kw">lines.segmented</span>(fit_segmented)</a>
<a class="sourceLine" id="cb13-4" title="4"><span class="kw">points.segmented</span>(fit_segmented)</a></code></pre></div>
<p><img src="packages_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Because the fitted objects returned by <code>segmented</code> contains <code>aic</code>, <code>deviance</code>, etc. it is in principle possible to do model comparison. Here is a BIC-based Bayes Factor testing whether there is one or two change points in the data:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">fit_segmented_<span class="dv">1</span> =<span class="st"> </span><span class="kw">segmented</span>(fit_lm, <span class="dt">seg.Z =</span> <span class="op">~</span>x, <span class="dt">npsi =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb14-2" title="2">BF =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>((<span class="kw"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span>(fit_segmented) <span class="op">-</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/stats/AIC.html">BIC</a></span>(fit_segmented_<span class="dv">1</span>))<span class="op">/</span><span class="dv">2</span>)  <span class="co"># From Wagenmakers (2007)</span></a>
<a class="sourceLine" id="cb14-3" title="3">BF</a></code></pre></div>
<pre><code>## [1] 21.87528</code></pre>
<p>We can do the same using <code>mcp</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">model_<span class="dv">1</span> =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(y<span class="op">~</span><span class="dv">1</span>, <span class="dv">1</span><span class="op">~</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb16-2" title="2">fit_mcp_<span class="dv">1</span> =<span class="st"> </span><span class="kw"><a href="../reference/mcp.html">mcp</a></span>(model_<span class="dv">1</span>, <span class="dt">data =</span> df, <span class="dt">par_x =</span> <span class="st">"x"</span>)</a>
<a class="sourceLine" id="cb16-3" title="3">fit_mcp_<span class="dv">1</span><span class="op">$</span>loo =<span class="st"> </span><span class="kw"><a href="../reference/criterion.html">loo</a></span>(fit_mcp_<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb16-4" title="4">fit_mcp<span class="op">$</span>loo =<span class="st"> </span><span class="kw"><a href="../reference/criterion.html">loo</a></span>(fit_mcp)</a>
<a class="sourceLine" id="cb16-5" title="5">loo<span class="op">::</span><span class="kw"><a href="https://mc-stan.org/loo/reference/loo_compare.html">loo_compare</a></span>(fit_mcp<span class="op">$</span>loo, fit_mcp_<span class="dv">1</span><span class="op">$</span>loo)</a></code></pre></div>
<pre><code>##        elpd_diff se_diff
## model1  0.0       0.0   
## model2 -5.5       2.8</code></pre>
<p>While <code>segmented</code> prefers the one-change-point model, <code>mcp</code> prefers the (true) two-change-point model. Again, the models compared here are <em>very</em> different since <code>segmented</code> does inference on a slope-only model.</p>
</div>
<div id="breakpoints" class="section level1">
<h1 class="hasAnchor">
<a href="#breakpoints" class="anchor"></a>breakpoints</h1>
<p><code><a href="https://rdrr.io/pkg/strucchange/man/breakpoints.html">strucchange::breakpoints()</a></code> is a lot like <code>segmented</code>. The difference is that (1) it is limited to gaussian residuals, and (2) it actually models intercepts, quadratic terms, etc. It scans through fits with 1, 2, 3,… N break points and determine where the optimal break points between this number of segments would lie. For each model it computes the Residual Sum of Squares (RSS; monotonically smaller with increasing N) and the Bayesian Information Criterion (BIC; has a minimum) for each N. It selects the model with the smallest BIC.</p>
<p>For an intercept-only model (<code>y ~ 1</code>) it correctly detects the two change points with estimates similar to <code>mcp</code>. As with most other packages, there are no intervals on the change points nor estimates of the parameters of the segments in between.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(strucchange)</a></code></pre></div>
<pre><code>## Loading required package: sandwich</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">fit_bp =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/strucchange/man/breakpoints.html">breakpoints</a></span>(y <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> df, <span class="dt">breaks =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb20-2" title="2"><span class="kw"><a href="../reference/summary.mcpfit.html">summary</a></span>(fit_bp)</a></code></pre></div>
<pre><code>## 
##   Optimal (m+1)-segment partition: 
## 
## Call:
## breakpoints.formula(formula = y ~ 1, breaks = 2, data = df)
## 
## Breakpoints at observation number:
##              
## m = 1   30   
## m = 2   30 65
## 
## Corresponding to breakdates:
##                 
## m = 1   0.3     
## m = 2   0.3 0.65
## 
## Fit:
##                      
## m   0     1     2    
## RSS 177.7 122.3 103.5
## BIC 350.5 322.4 314.8</code></pre>
<p>Reassuringly, for <code>y ~ 1 + x</code> it “recommends” the same single change point that <code>segmented</code> found for this model.</p>
</div>
<div id="cpm" class="section level1">
<h1 class="hasAnchor">
<a href="#cpm" class="anchor"></a>cpm</h1>
<p><code>cpm</code> is an intercept-only (in mean and variance) package, so it cannot model slopes. It can detect single change points via <code>detectChangePoint</code> and multiple change points via <code>processStream</code>. <code>processStream</code> is an automatic change point detection, using a p-value threshold to determine if a candidate should be marked as a hit. Multiple ways of computing p-values (<code>cpmType</code>) are available. In my limited testing, they return similar change points, though not identical.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(cpm)</a>
<a class="sourceLine" id="cb22-2" title="2"><span class="co">#fit_cpm = detectChangePoint(df$y, cpmType = "Student")  # a single change point</span></a>
<a class="sourceLine" id="cb22-3" title="3"><span class="co">#fit_cpm = processStream(df$y, cpmType = "Mann-Whitney")  # Detects three</span></a>
<a class="sourceLine" id="cb22-4" title="4">fit_cpm =<span class="st"> </span><span class="kw">processStream</span>(df<span class="op">$</span>y, <span class="dt">cpmType =</span> <span class="st">"Student"</span>)  <span class="co"># Multiple change points</span></a>
<a class="sourceLine" id="cb22-5" title="5">fit_cpm<span class="op">$</span>changePoints</a></code></pre></div>
<pre><code>## [1] 30 62</code></pre>
<p>It detects two change points, which is good. No intervals are returned and no plot functions are provided. The second change point is estimated a bit further away from the true value than <code>mcp</code>.</p>
</div>
<div id="changepoint-and-changepoint-np" class="section level1">
<h1 class="hasAnchor">
<a href="#changepoint-and-changepoint-np" class="anchor"></a>changepoint and changepoint.np</h1>
<p><code>changepoint</code> is focused on intercept-only changes. It can estimate changes in means (<code>cpt.mean</code>), variance (<code>cpt.var</code>), or both (<code>cpt.meanvar</code>). It is semi-automatic in that you can set the number of change points using parameter <code>Q</code> and this defaults to five. It can recover ML estimates of the intercepts. It does not estimate uncertainty, nor model checking. It only takes a response variable, so the change point is the data <em>index</em>, not the point on an x-axis. Make sure that your data is ordered. In our case it is ordered and we have 1 data point at each <code>x</code>, so it is optimal for <code>changepoint</code>.</p>
<p>It detects the first change point, but not the second.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(changepoint)</a>
<a class="sourceLine" id="cb24-2" title="2">fit_changepoint =<span class="st"> </span><span class="kw">cpt.mean</span>(df<span class="op">$</span>y)</a>
<a class="sourceLine" id="cb24-3" title="3"></a>
<a class="sourceLine" id="cb24-4" title="4"><span class="co"># Return estimates</span></a>
<a class="sourceLine" id="cb24-5" title="5"><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">ints =</span> <span class="kw">param.est</span>(fit_changepoint)<span class="op">$</span>mean,</a>
<a class="sourceLine" id="cb24-6" title="6">  <span class="dt">cp =</span> <span class="kw">cpts</span>(fit_changepoint))</a></code></pre></div>
<pre><code>##      ints1      ints2         cp 
##  2.0685868  0.4456268 30.0000000</code></pre>
<p>Plot:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1"><span class="kw"><a href="../reference/plot.mcpfit.html">plot</a></span>(fit_changepoint)</a></code></pre></div>
<p><img src="packages_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>The package <code>changepoint.np</code> extends <code>changepoint</code> by providing a non-parametric version. It is unclear which of the <code>changepoint</code> functions are extended, but it manages to find both change points to a good precision. As with many other packages, no intervals are provided. As mentioned earlier, I suspect that <code>EnvCpt</code> uses this function under the hood.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" title="1">changepoint.np<span class="op">::</span><span class="kw">cpt.np</span>(df<span class="op">$</span>y)<span class="op">@</span>cpts</a></code></pre></div>
<pre><code>## [1]  29  65 100</code></pre>
</div>
<div id="bcp" class="section level1">
<h1 class="hasAnchor">
<a href="#bcp" class="anchor"></a>bcp</h1>
<p><code>bcp</code> is the only other Bayesian package in the game. It automatically detects change points and segment types, though you can use the parameter <code>d</code> to increase the prior probability of intercept-only models. It provides estimates of means and probability of change point <em>at each x-coordinate</em>. It has little additional functionality. The summary method conveys the same as the plot, so let’s stick to the plot.</p>
<p>We see that it vaguely captures the change point at <code>x = 30</code>, and has some smeared-out probability around <code>x = 60</code> (<code>mcp</code> detected a single change point at <code>x = 64</code> here). <code>bcp</code> has some “false alarms” at <code>x &lt; 20</code>.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(bcp)</a>
<a class="sourceLine" id="cb29-2" title="2">fit_bcp =<span class="st"> </span><span class="kw">bcp</span>(df<span class="op">$</span>y, <span class="dt">d =</span> <span class="dv">1000</span>)</a>
<a class="sourceLine" id="cb29-3" title="3"><span class="kw"><a href="../reference/plot.mcpfit.html">plot</a></span>(fit_bcp)</a></code></pre></div>
<p><img src="packages_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
</div>
<div id="ecp" class="section level1">
<h1 class="hasAnchor">
<a href="#ecp" class="anchor"></a>ecp</h1>
<p><code>ecp</code> contains six functions to detect change points. It is clearly built for multivariate data, but can take univariate too. Of the six functions, I have not managed to get <code>e.agglo</code> working for <code>df</code>, but here I demonstrate the other five. The resulting information is sparse. It detects one of the two change points, but not both (with the exception of <code>e.divisive</code>, which returns four),</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" title="1">df_ecp =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(df<span class="op">$</span>y)</a>
<a class="sourceLine" id="cb30-2" title="2">fit_ecp1 =<span class="st"> </span>ecp<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ecp/man/e.cp3o.html">e.cp3o</a></span>(df_ecp, <span class="dt">K =</span> <span class="dv">2</span>)  <span class="co"># maximum 2 change points</span></a>
<a class="sourceLine" id="cb30-3" title="3">fit_ecp2 =<span class="st"> </span>ecp<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ecp/man/e.cp3o_delta.html">e.cp3o_delta</a></span>(df_ecp, <span class="dt">K =</span> <span class="dv">2</span>)  <span class="co"># maximum 2 change points</span></a>
<a class="sourceLine" id="cb30-4" title="4">fit_ecp3 =<span class="st"> </span>ecp<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ecp/man/e.divisive.html">e.divisive</a></span>(df_ecp, <span class="dt">k =</span> <span class="dv">2</span>)  <span class="co"># 2 change points. Ignored???</span></a>
<a class="sourceLine" id="cb30-5" title="5">fit_ecp4 =<span class="st"> </span>ecp<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ecp/man/ks.cp3o.html">ks.cp3o</a></span>(df_ecp, <span class="dt">K =</span> <span class="dv">2</span>)  <span class="co"># maximum 2 change points</span></a>
<a class="sourceLine" id="cb30-6" title="6">fit_ecp5 =<span class="st"> </span>ecp<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/ecp/man/ks.cp3o_delta.html">ks.cp3o_delta</a></span>(df_ecp, <span class="dt">K =</span> <span class="dv">2</span>)  <span class="co"># maximum 2 change points</span></a>
<a class="sourceLine" id="cb30-7" title="7"></a>
<a class="sourceLine" id="cb30-8" title="8"><span class="co"># Show the change point estimates</span></a>
<a class="sourceLine" id="cb30-9" title="9"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb30-10" title="10">  <span class="dt">e.cp3o =</span> fit_ecp1<span class="op">$</span>estimates,</a>
<a class="sourceLine" id="cb30-11" title="11">  <span class="dt">e.cp3o_delta =</span> fit_ecp2<span class="op">$</span>estimates,</a>
<a class="sourceLine" id="cb30-12" title="12">  <span class="dt">e.divisive =</span> fit_ecp3<span class="op">$</span>estimates,</a>
<a class="sourceLine" id="cb30-13" title="13">  <span class="dt">ks.cp30 =</span> fit_ecp4<span class="op">$</span>estimates,</a>
<a class="sourceLine" id="cb30-14" title="14">  <span class="dt">ks.cp3o_delta =</span> fit_ecp5<span class="op">$</span>estimates</a>
<a class="sourceLine" id="cb30-15" title="15">))</a></code></pre></div>
<pre><code>## List of 5
##  $ e.cp3o       : int 31
##  $ e.cp3o_delta : int 60
##  $ e.divisive   : num [1:4] 1 31 63 101
##  $ ks.cp30      : int 31
##  $ ks.cp3o_delta: int 31</code></pre>
</div>
<div id="tsmcp" class="section level1">
<h1 class="hasAnchor">
<a href="#tsmcp" class="anchor"></a>TSMCP</h1>
<p>Short for “Time-Series Multiple Change Point”. The output is a single number (!). For the problem at hand, changing <code>method</code> makes no difference. For many other <code>c</code> (<code>c = 0.3</code>, <code>c = 4</code>), it fails to find any change points at all. There is also <code><a href="https://rdrr.io/pkg/TSMCP/man/cpvnts.html">TSMCP::cpvnts()</a></code> to model AR(N), but I have failed to make it find any change points in the present data set.</p>
<p>It finds the change point at <code>x = 30</code>, but not the second change point at <code>x = 70</code>.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" title="1">TSMCP<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/TSMCP/man/tsmcplm.html">tsmcplm</a></span>(df<span class="op">$</span>y, <span class="dt">X =</span> <span class="ot">NULL</span>, <span class="dt">method =</span> <span class="st">"adapt"</span>, <span class="dt">c =</span> <span class="dv">1</span>)</a></code></pre></div>
<pre><code>## [1] 30</code></pre>
</div>
<div id="wbsts" class="section level1">
<h1 class="hasAnchor">
<a href="#wbsts" class="anchor"></a>wbsts</h1>
<p>The <code>wbsts</code> package is focused at time-series data. I must admit that I have not taken the time to understand the underlying model(s) or inference methods, so I am in a poor position to evaluate whether I am using it correctly. It returns no change points for the present data set using default settings:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" title="1">wbsts<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/wbsts/man/wbs.lsw.html">wbs.lsw</a></span>(df<span class="op">$</span>y)</a></code></pre></div>
<pre><code>## $cp.bef
## NULL
## 
## $cp.aft
## NULL</code></pre>
</div>
<div id="robtschangerob" class="section level1">
<h1 class="hasAnchor">
<a href="#robtschangerob" class="anchor"></a>robts::changerob</h1>
<p><code>robts</code> is about robust time-series regression. It is not on CRAN, so it has to be installed using <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("robts", repos="http://R-Forge.R-project.org")</a></code>. I fail to install the dependencies, and development of the package seems to have stopped around 2014. It won’t be covered further here.</p>
</div>
<div id="packages-doing-only-one-change-point" class="section level1">
<h1 class="hasAnchor">
<a href="#packages-doing-only-one-change-point" class="anchor"></a>Packages doing only one change point</h1>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/strucchange/man/Fstats.html">strucchange::Fstats</a></code>: Returns the estimated change point (one number), and nothing else. <code><a href="https://rdrr.io/pkg/strucchange/man/Fstats.html">strucchange::Fstats(y ~ 1, data = df)</a></code> find the change point at 30 in the present data.</li>
<li>
<code><a href="https://rdrr.io/pkg/SiZer/man/piecewise.linear.html">SiZer::piecewise.linear</a></code>: Returns a change point and parameter estimates, optionally with an interval. Call like <code>piecewise.linear(df$x, df$y, CI = TRUE)</code>. Only joined slopes are supported which makes it misestimate the change point in the present data 39 [36.5, 47], but it is consistent with <code>segmented</code> which uses a similar model.</li>
<li>
<code><a href="https://rdrr.io/pkg/easyreg/man/bl.html">easyreg::bl</a></code>.</li>
<li>
<code><a href="https://rdrr.io/pkg/lm.br/man/lm.br.html">lm.br::lm.br</a></code>. Choose between line-line, line-plateau, or plateau-line. Yields confidence intervals. All of these are non-suitable for the present plateau-only model. <code>lm.br</code> stands out with the following features: (1) it can take multiple predictors, and it uniquely only models change point over just one of them, keeping the others constant. In comparison, <code>segmented</code> models changes in everything, as far as I understand it. (2) It can take known variance. (3) It can take data weights.</li>
</ul>
</div>
<div id="packages-doing-only-fixed-change-points" class="section level1">
<h1 class="hasAnchor">
<a href="#packages-doing-only-fixed-change-points" class="anchor"></a>Packages doing only fixed change points</h1>
<p>As explained in <a href="../articles/formulas.htm">the article on mcp formulas</a>, fixed change points can be implemented in almost all regression functions. You simply have an indicator variable saying whether there has been as shift at the corresponding x-value and use it like <code><a href="https://rdrr.io/r/stats/lm.html">lm(y ~ 1 + x * I(x &gt; 30), data = df)</a></code>. Or if you don’t want a carry-over effect from the first segment, do <code><a href="https://rdrr.io/r/stats/lm.html">lm(y ~ 1 * I(x &lt; 30) + x * I(x &gt;= 30), data = df)</a></code>. This will work for most regression packages in R, including <code>survival</code> and <code>lme4</code>.</p>
<p>Some packages include this in a way where you don’t have to code your indicators yourself, including:</p>
<ul>
<li>
<code><a href="https://rdrr.io/pkg/scan/man/plm.html">scan::plm</a></code> and <code><a href="https://rdrr.io/pkg/scan/man/hplm.html">scan::hplm</a></code>. To get started here, make sure to transform your data to a <code><a href="https://rdrr.io/pkg/scan/man/scdf.html">scan::scdf</a></code> object.</li>
</ul>
</div>
<div id="others" class="section level1">
<h1 class="hasAnchor">
<a href="#others" class="anchor"></a>Others</h1>
<p>I have yet to test these:</p>
<ul>
<li>
<code>TSIS</code> may be coerced to do change point analysis, though it is mean for much more complicated switch point models in gene expression analysis. It’s primary interface is a Shiny App.</li>
<li>
<code>plrs::plrs</code>. Piecewise Linear Regression, targeted at DNA and gene expression. May also be coerced into simpler problems.</li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#modeling-options">Modeling options</a></li>
      <li><a href="#inference">Inference</a></li>
      <li><a href="#other-conveniences">Other conveniences</a></li>
      <li><a href="#unique-features-of-mcp">Unique features of mcp</a></li>
      <li><a href="#recommendation">Recommendation</a></li>
      <li><a href="#a-simple-dataset-to-compare-packages">A simple dataset to compare packages</a></li>
      <li><a href="#mcp">mcp</a></li>
      <li><a href="#envcpt">EnvCpt</a></li>
      <li><a href="#segmented">segmented</a></li>
      <li><a href="#breakpoints">breakpoints</a></li>
      <li><a href="#cpm">cpm</a></li>
      <li><a href="#changepoint-and-changepoint-np">changepoint and changepoint.np</a></li>
      <li><a href="#bcp">bcp</a></li>
      <li><a href="#ecp">ecp</a></li>
      <li><a href="#tsmcp">TSMCP</a></li>
      <li><a href="#wbsts">wbsts</a></li>
      <li><a href="#robtschangerob">robts::changerob</a></li>
      <li><a href="#packages-doing-only-one-change-point">Packages doing only one change point</a></li>
      <li><a href="#packages-doing-only-fixed-change-points">Packages doing only fixed change points</a></li>
      <li><a href="#others">Others</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://lindeloev.net">Jonas Kristoffer Lindeløv</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '702ab134d40a7310606c29f341fc5014',
    indexName: 'lindeloev_mcp',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>

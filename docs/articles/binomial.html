<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Binomial change point analysis with mcp • mcp</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Binomial change point analysis with mcp">
<meta property="og:description" content="">
<meta property="og:image" content="https://lindeloev.github.io/mcp/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-1026978-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-1026978-3');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mcp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    General usage
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/formulas.html">Formulas</a>
    </li>
    <li>
      <a href="../articles/priors.html">Priors</a>
    </li>
    <li>
      <a href="../articles/comparison.html">Hypotheses and model comparison</a>
    </li>
    <li>
      <a href="../articles/varying.html">Random/varying effects</a>
    </li>
    <li>
      <a href="../articles/variance.html">Modeling variance</a>
    </li>
    <li>
      <a href="../articles/arma.html">Time series and autocorrelation</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    GLM
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/poisson.html">Poisson</a>
    </li>
    <li>
      <a href="../articles/binomial.html">Binomial and Bernoulli</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Other
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/packages.html">Comparison to other packages</a>
    </li>
    <li>
      <a href="../articles/debug.html">Tips, tricks, and debugging</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://twitter.com/jonaslindeloev">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/lindeloev/mcp">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Binomial change point analysis with mcp</h1>
                        <h4 class="author">Jonas Kristoffer Lindeløv</h4>
            
            <h4 class="date">2020-01-10</h4>
      
      
      <div class="hidden name"><code>binomial.Rmd</code></div>

    </div>

    
    
<p><code>mcp</code> aims to implement Generalized Linear Models in a way that closely mimics that of <a href="https://github.com/paul-buerkner/brms">brms::brm</a>. You can set the family and link functions using the <code>family</code> argument.</p>
<p>First, let us specify a toy model with three segments:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1">model =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(</a>
<a class="sourceLine" id="cb1-2" title="2">  y <span class="op">|</span><span class="st"> </span><span class="kw">trials</span>(N) <span class="op">~</span><span class="st"> </span><span class="dv">1</span>,  <span class="co"># constant rate</span></a>
<a class="sourceLine" id="cb1-3" title="3">  <span class="op">~</span><span class="st"> </span><span class="dv">0</span> <span class="op">+</span><span class="st"> </span>year,  <span class="co"># joined changing rate</span></a>
<a class="sourceLine" id="cb1-4" title="4">  <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>year  <span class="co"># disjoined changing rate</span></a>
<a class="sourceLine" id="cb1-5" title="5">)</a></code></pre></div>
<div id="simulate-data" class="section level1">
<h1 class="hasAnchor">
<a href="#simulate-data" class="anchor"></a>Simulate data</h1>
<p>If you already have data, you can safely skip this section.</p>
<p>We run <code>mcp</code> with <code>sample = FALSE</code> to get what we need to simulate data.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(mcp)</a>
<a class="sourceLine" id="cb2-2" title="2">empty =<span class="st"> </span><span class="kw"><a href="../reference/mcp.html">mcp</a></span>(model, <span class="dt">family =</span> <span class="kw"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>(), <span class="dt">sample =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>Now we can simulate. First, let us see the model parameters.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">empty<span class="op">$</span>pars</a></code></pre></div>
<pre><code>## $x
## [1] "year"
## 
## $y
## [1] "y"
## 
## $trials
## [1] "N"
## 
## $varying
## NULL
## 
## $sigma
## character(0)
## 
## $arma
## character(0)
## 
## $reg
## [1] "cp_1"   "cp_2"   "int_1"  "int_3"  "year_2" "year_3"
## 
## $population
## [1] "cp_1"   "cp_2"   "int_1"  "int_3"  "year_2" "year_3"</code></pre>
<ul>
<li>It takes two intercepts (<code>int_*</code>), for segments 1 and 3.</li>
<li>It takes two slopes (<code>year_*</code>), for segment 2 and 3.</li>
<li>It takes two change points (<code>cp_*</code>) - one between each segment.</li>
</ul>
<p><code>empty$simulate</code> is now a function that can predict data given these parameters. If you are in a reasonable R editor, type <code>empty$simulate(</code> and press TAB to see the required arguments. I came up with some values below, including change points at <span class="math inline">\(year = 25\)</span> and <span class="math inline">\(year = 65\)</span>. Notice that because <code><a href="https://rdrr.io/r/stats/family.html">binomial()</a></code> defaults to the link function <code>link = "logit"</code>, the intercept and slopes are on a <a href="https://en.wikipedia.org/wiki/Logit">logit scale</a>. Briefly, this extends the narrow range of binomial rates (0-1) to an infinite logit scale from minus infinity to plus infinity. This will be important later when we set priors.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">df =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(</a>
<a class="sourceLine" id="cb5-2" title="2">  <span class="dt">year =</span> <span class="dv">1901</span><span class="op">:</span><span class="dv">2000</span>,  <span class="co"># evaluate for each of these</span></a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="dt">N =</span> <span class="kw"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="dv">10</span><span class="op">:</span><span class="dv">20</span>, <span class="dt">size =</span> <span class="dv">100</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)  <span class="co"># number of trials</span></a>
<a class="sourceLine" id="cb5-4" title="4">)</a>
<a class="sourceLine" id="cb5-5" title="5">df<span class="op">$</span>y =<span class="st"> </span>empty<span class="op">$</span><span class="kw"><a href="https://rdrr.io/r/stats/simulate.html">simulate</a></span>(</a>
<a class="sourceLine" id="cb5-6" title="6">  df<span class="op">$</span>year, df<span class="op">$</span>N, </a>
<a class="sourceLine" id="cb5-7" title="7">  <span class="dt">cp_1 =</span> <span class="dv">1925</span>, <span class="dt">cp_2 =</span> <span class="dv">1965</span>, </a>
<a class="sourceLine" id="cb5-8" title="8">  <span class="dt">int_1 =</span> <span class="dv">2</span>, <span class="dt">int_3 =</span> <span class="dv">0</span>, </a>
<a class="sourceLine" id="cb5-9" title="9">  <span class="dt">year_2 =</span> <span class="fl">-0.2</span>, <span class="dt">year_3 =</span> <span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb5-10" title="10"></a>
<a class="sourceLine" id="cb5-11" title="11">df</a></code></pre></div>
<pre><code>##     year  N  y
## 1   1901 12 11
## 2   1902 18 16
## 3   1903 19 18
## 4   1904 20 18
## 5   1905 14 13
## 6   1906 17 17
## 7   1907 19 18
## 8   1908 16 15
## 9   1909 14  9
## 10  1910 19 17
## 11  1911 17 14
## 12  1912 12 10
## 13  1913 13 12
## 14  1914 19 16
## 15  1915 15 15
## 16  1916 17 14
## 17  1917 12 11
## 18  1918 17 15
## 19  1919 10 10
## 20  1920 14 11
## 21  1921 18 17
## 22  1922 12 11
## 23  1923 12 11
## 24  1924 10  9
## 25  1925 11 11
## 26  1926 20 17
## 27  1927 13 10
## 28  1928 16 15
## 29  1929 11  8
## 30  1930 20 17
## 31  1931 18 15
## 32  1932 14  9
## 33  1933 11  8
## 34  1934 20 10
## 35  1935 13  7
## 36  1936 16  5
## 37  1937 19  6
## 38  1938 11  5
## 39  1939 19  2
## 40  1940 14  4
## 41  1941 12  4
## 42  1942 19  5
## 43  1943 14  3
## 44  1944 19  5
## 45  1945 10  1
## 46  1946 19  4
## 47  1947 18  0
## 48  1948 13  1
## 49  1949 19  1
## 50  1950 13  1
## 51  1951 18  0
## 52  1952 16  2
## 53  1953 15  0
## 54  1954 16  0
## 55  1955 15  0
## 56  1956 12  0
## 57  1957 20  0
## 58  1958 11  1
## 59  1959 20  1
## 60  1960 14  0
## 61  1961 13  0
## 62  1962 12  0
## 63  1963 20  0
## 64  1964 13  0
## 65  1965 14  9
## 66  1966 13  5
## 67  1967 19  9
## 68  1968 17  9
## 69  1969 17  8
## 70  1970 10  7
## 71  1971 14  6
## 72  1972 16  5
## 73  1973 18 13
## 74  1974 10  7
## 75  1975 20 13
## 76  1976 15 11
## 77  1977 15  8
## 78  1978 14 11
## 79  1979 12  7
## 80  1980 18 14
## 81  1981 18 14
## 82  1982 16  8
## 83  1983 10  8
## 84  1984 15 10
## 85  1985 13 11
## 86  1986 14 11
## 87  1987 11  8
## 88  1988 17  8
## 89  1989 18 15
## 90  1990 14 11
## 91  1991 20 17
## 92  1992 13 12
## 93  1993 13 12
## 94  1994 18 17
## 95  1995 15 14
## 96  1996 14 12
## 97  1997 19 17
## 98  1998 13 11
## 99  1999 16 16
## 100 2000 13 12</code></pre>
<p>Visually:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw"><a href="../reference/plot.mcpfit.html">plot</a></span>(df<span class="op">$</span>year, df<span class="op">$</span>y)</a></code></pre></div>
<p><img src="binomial_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
</div>
<div id="check-parameter-recovery" class="section level1">
<h1 class="hasAnchor">
<a href="#check-parameter-recovery" class="anchor"></a>Check parameter recovery</h1>
<p>The next sections go into more detail, but let us quickly see if we can recover the parameters used to simulate the data.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">fit =<span class="st"> </span><span class="kw"><a href="../reference/mcp.html">mcp</a></span>(model, <span class="dt">data =</span> df, <span class="dt">family =</span> <span class="kw"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>(), <span class="dt">adapt =</span> <span class="dv">5000</span>)</a></code></pre></div>
<p>We can use <code>summary</code> to see that it recovered the parameters to a pretty good precision. Again, recall that intercepts and slopes are on a <code>logit</code> scale.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw"><a href="../reference/summary.mcpfit.html">summary</a></span>(fit)</a></code></pre></div>
<pre><code>## Family: binomial(link = 'logit')
## Iterations: 9000 from 3 chains.
## Segments:
##   1: y | trials(N) ~ 1
##   2: y | trials(N) ~ 1 ~ 0 + year
##   3: y | trials(N) ~ 1 ~ 1 + year
## 
## Population-level parameters:
##    name match     sim     mean    lower    upper Rhat n.eff
##    cp_1    OK 1925.00 1921.325 1917.853 1925.090    1   500
##    cp_2       1965.00 1964.500 1964.035 1964.982    1  5456
##   int_1    OK    2.00    2.119    1.769    2.497    1   929
##   int_3    OK    0.00    0.050   -0.284    0.380    1  1011
##  year_2         -0.20   -0.162   -0.186   -0.139    1   972
##  year_3    OK    0.05    0.038    0.022    0.056    1   992</code></pre>
<p><code>summary</code> uses 95% highest density intervals (HDI) by default, but you can change it using <code><a href="../reference/summary.mcpfit.html">summary(fit, width = 0.80)</a></code>. If you have <a href="../articles/varying.html">varying effects</a>, use <code><a href="../reference/summary.mcpfit.html">ranef(fit)</a></code> to see them.</p>
<p>Plotting the fit confirms good fit to the data, and we see the discontinuities at the two change points:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="kw"><a href="../reference/plot.mcpfit.html">plot</a></span>(fit)</a></code></pre></div>
<p><img src="binomial_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>These lines are just <code>fit$simulate</code> applied to a random draw of the posterior samples. In other words, they represent the joint distribution of the parameters. You can change the number of draws (lines) using <code><a href="../reference/plot.mcpfit.html">plot(fit, lines = 50)</a></code>.</p>
<p>Notice for binomial models it defaults to plot the <em>rate</em> (<code>y / N</code>) as a function of x. The reason why is obvious when we plot on “raw” data by toggling <code>rate</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw"><a href="../reference/plot.mcpfit.html">plot</a></span>(fit, <span class="dt">rate =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="binomial_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>These lines are jagged because <code>N</code> varies from year to year. Although there is close too 100% success rate in the years 1900 - 1920, the number of trials varies, as you can see in the raw data. However, using <code>rate = FALSE</code> will be great when the number of trials is constant for extended periods of time, as <code>y</code> is more interpretable then.</p>
<p>Of course, these plots work with <a href="../articles/varying.html">varying effects</a> as well.</p>
</div>
<div id="model-diagnostics-and-sampling-options" class="section level1">
<h1 class="hasAnchor">
<a href="#model-diagnostics-and-sampling-options" class="anchor"></a>Model diagnostics and sampling options</h1>
<p>Already in the default <code>plot</code> as used above, it will be obvious if there was poor convergence. A more direct assessment is to look at the posterior distributions and trace plots:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1"><span class="kw"><a href="../reference/plot_pars.html">plot_pars</a></span>(fit)</a></code></pre></div>
<p><img src="binomial_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
<p>Convergence is perfect here as evidenced by the overlapping trace plots that look like fat caterpillars (Bayesians love fat caterpillars). Notice that the posterior distribution of change points can be quite non-normal and sometimes even bimodal. Therefore, one should be careful not to interpret the HDI as if it was normal.</p>
<p><code><a href="../reference/plot.mcpfit.html">plot()</a></code> and <code><a href="../reference/plot_pars.html">plot_pars()</a></code> can do a lot more than this, so check out their documentation.</p>
</div>
<div id="priors-for-binomial-models" class="section level1">
<h1 class="hasAnchor">
<a href="#priors-for-binomial-models" class="anchor"></a>Priors for binomial models</h1>
<p><code>mcp</code> uses priors to achieve a lot of it’s functionality. See <a href="../articles/priors.html">how to set priors</a>, including how to share parameters between segments and how to fix values. Here, I post a few notes about the binomial-specific default priors.</p>
<p>The default priors in <code>mcp</code> are set so that they are reasonably broad to cover most scenarios, though also specific enough to sample effectively. They are not “default” as in “canonical”. Rather, they are “default” as in “what happens if you do nothing else”. All priors are stored in <code>fit$prior</code> (also <code>empty$prior</code>). We did not specify <code>prior</code> above, so it ran with default priors:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(fit<span class="op">$</span>prior)</a></code></pre></div>
<pre><code>##        [,1]                                                    
## cp_1   "dt(MINX, (MAXX - MINX) / N_CP, N_CP - 1) T(cp_0, MAXX)"
## cp_2   "dt(MINX, (MAXX - MINX) / N_CP, N_CP - 1) T(cp_1, MAXX)"
## int_1  "dnorm(0, 3)"                                           
## int_3  "dnorm(0, 3)"                                           
## year_2 "dnorm(0, 3 / (MAXX - MINX))"                           
## year_3 "dnorm(0, 3 / (MAXX - MINX))"</code></pre>
<p>The priors on change points are discussed extensively in the prior vignette. The priors on slopes and intercepts are normals with standard deviation of “3” logits. This corresponds to quite extreme binomial probabilities, yet not so extreme as to be totally flat. Here are visualization of priors <code><a href="https://rdrr.io/r/stats/Normal.html">dnorm(0, 1)</a></code> (red), <code><a href="https://rdrr.io/r/stats/Normal.html">dnorm(0, 2)</a></code> (black, mcp default), and a <code><a href="https://rdrr.io/r/stats/Normal.html">dnorm(0, 5)</a></code> (blue) prior, and the correspondence between logits and probabilities:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">inverse_logit =<span class="st"> </span><span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(x) <span class="op">/</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(x))</a>
<a class="sourceLine" id="cb16-2" title="2"></a>
<a class="sourceLine" id="cb16-3" title="3"><span class="co"># Start the plot</span></a>
<a class="sourceLine" id="cb16-4" title="4"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb16-5" title="5"><span class="kw">ggplot</span>(<span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">logits =</span> <span class="dv">0</span>), <span class="kw">aes</span>(<span class="dt">x =</span> logits)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-6" title="6"><span class="st">  </span></a>
<a class="sourceLine" id="cb16-7" title="7"><span class="st">  </span><span class="co"># Plot normal prior. Set parameters in "args"</span></a>
<a class="sourceLine" id="cb16-8" title="8"><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun=</span>dnorm, <span class="dt">args =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">mean=</span><span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>), <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">"red"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb16-9" title="9"><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun=</span>dnorm, <span class="dt">args =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">mean=</span><span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">3</span>), <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">"black"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb16-10" title="10"><span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">fun=</span>dnorm, <span class="dt">args =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">mean=</span><span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">5</span>), <span class="dt">lwd=</span><span class="dv">2</span>, <span class="dt">col=</span><span class="st">"blue"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb16-11" title="11"><span class="st">  </span></a>
<a class="sourceLine" id="cb16-12" title="12"><span class="st">  </span><span class="co"># Set the secondary axis</span></a>
<a class="sourceLine" id="cb16-13" title="13"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks =</span> <span class="dv">-7</span><span class="op">:</span><span class="dv">7</span>,<span class="dt">limits =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">7</span>, <span class="dv">7</span>), <span class="dt">sec.axis =</span> <span class="kw">sec_axis</span>(<span class="op">~</span><span class="st"> </span><span class="kw">inverse_logit</span>(.), <span class="dt">name =</span> <span class="st">"Probability"</span>, <span class="dt">breaks =</span> <span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw">inverse_logit</span>(<span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="op">-</span><span class="dv">7</span>, <span class="dv">7</span>, <span class="dt">by =</span> <span class="dv">2</span>)), <span class="dv">3</span>)))</a></code></pre></div>
<p><img src="binomial_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>Please keep in mind that when these priors combine through the model, the joint probability may be quite different.</p>
<p>Returning to the priors, the <code>3 / (MAXX - MINX)</code> on slopes mean that this change in probability occurs over the course of the observed X.</p>
</div>
<div id="jags-code" class="section level1">
<h1 class="hasAnchor">
<a href="#jags-code" class="anchor"></a>JAGS code</h1>
<p>Here is the JAGS code for the model used in this article.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/cat.html">cat</a></span>(fit<span class="op">$</span>jags_code)</a></code></pre></div>
<pre><code>## 
## model {
## 
##   # Priors for population-level effects
##   cp_0 = MINX  # mcp helper value.
##   cp_3 = MAXX  # mcp helper value.
## 
##   cp_1 ~ dt(MINX, 1/((MAXX-MINX)/N_CP)^2, N_CP-1) T(cp_0, MAXX)
##   cp_2 ~ dt(MINX, 1/((MAXX-MINX)/N_CP)^2, N_CP-1) T(cp_1, MAXX)
##   int_1 ~ dnorm(0, 1/(3)^2) 
##   int_3 ~ dnorm(0, 1/(3)^2) 
##   year_2 ~ dnorm(0, 1/(3/(MAXX-MINX))^2) 
##   year_3 ~ dnorm(0, 1/(3/(MAXX-MINX))^2) 
## 
## 
##   # Model and likelihood
##   for (i_ in 1:length(year)) {
##     X_1_[i_] = min(year[i_], cp_1)
##     X_2_[i_] = min(year[i_], cp_2) - cp_1
##     X_3_[i_] = min(year[i_], cp_3) - cp_2
##     
##     # Fitted value
##     y_[i_] = 
##     
##       # Segment 1: y | trials(N) ~ 1
##       (year[i_] &gt;= cp_0) * (year[i_] &lt; cp_2) * int_1 + 
##     
##       # Segment 2: y | trials(N) ~ 1 ~ 0 + year
##       (year[i_] &gt;= cp_1) * (year[i_] &lt; cp_2) * year_2 * X_2_[i_] + 
##     
##       # Segment 3: y | trials(N) ~ 1 ~ 1 + year
##       (year[i_] &gt;= cp_2) * int_3 + 
##       (year[i_] &gt;= cp_2) * year_3 * X_3_[i_] 
## 
##     # Likelihood and log-density for family = binomial()
##     y[i_] ~ dbin(ilogit(y_[i_]), N[i_])
##     loglik_[i_] = logdensity.bin(y[i_], ilogit(y_[i_]), N[i_])
##   }
## }</code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#simulate-data">Simulate data</a></li>
      <li><a href="#check-parameter-recovery">Check parameter recovery</a></li>
      <li><a href="#model-diagnostics-and-sampling-options">Model diagnostics and sampling options</a></li>
      <li><a href="#priors-for-binomial-models">Priors for binomial models</a></li>
      <li><a href="#jags-code">JAGS code</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="http://lindeloev.net">Jonas Kristoffer Lindeløv</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '702ab134d40a7310606c29f341fc5014',
    indexName: 'lindeloev_mcp',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
